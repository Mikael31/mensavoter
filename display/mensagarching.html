<link rel="stylesheet" href="../styles/style.css">

<h1 id="title">Menü lädt …</h1>
<div id="menu"></div>

<script>
    (async ()=>{
        const $title = document.getElementById('title');
        const $menu  = document.getElementById('menu');

        /* immer festes File */
        const url = '../jsonpasser/data/mensa_garching.json';

        try{
            const res = await fetch(url);
            if(!res.ok) throw new Error(`${res.status} ${res.statusText}`);

            const json = await res.json();
            const day  = Array.isArray(json.days) ? json.days[0] : null;
            if(!day || !Array.isArray(day.dishes))
                throw new Error('JSON enthält kein days[0].dishes-Array');

            const d = new Date(day.date ?? Date.now());
            $title.textContent = `Speiseplan für ${d.toLocaleDateString('de-DE')}`;

            day.dishes.forEach(dish=>{
                const card = document.createElement('section');
                card.className = 'dish';
                card.innerHTML =
                    `<h3>${dish.name}</h3>`+
                    (dish.labels?.length ? `<p class="labels">${dish.labels.join(', ')}</p>`:'')+
                    (dish?.prices?.students?.base_price!=null
                        ? `<p class="price">${dish.prices.students.base_price.toFixed(2)} € für Studierende</p>`:'');
                $menu.appendChild(card);
            });

        }catch(err){
            $title.textContent = 'Fehler';
            $menu.innerHTML = `<p class="error">Konnte Daten nicht laden: ${err.message}</p>`;
        }
    })();
</script>