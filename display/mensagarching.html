<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <title>Mensa – Tagesmenü</title>

    <style>
        :root{ --tum-blue:#0065bd; --card-w:340px; }
        body{
            margin:0;
            font-family:system-ui,sans-serif;
            background:#f5f7fa;
            padding:2rem 1rem 4rem;
        }
        h1{
            margin:0 0 2rem;
            text-align:center;
            color:var(--tum-blue);
        }
        #menu{
            display:flex;
            flex-wrap:wrap;
            justify-content:center;
            gap:1.3rem;
        }
        .dish{
            width:var(--card-w);
            background:#fff;
            border:1.5px solid var(--tum-blue);
            border-radius:12px;
            box-shadow:0 2px 10px rgba(0,0,0,.08);
            padding:1.2rem 1.4rem;
            display:flex;
            flex-direction:column;
            gap:.4rem;
        }
        .dish h3{margin:.1rem 0 .3rem;font-size:1.1rem;font-weight:700}
        .labels{font-size:.85rem;color:#555;white-space:pre-line;margin-left:.25rem}
        .price{margin-top:.3rem;font-weight:600}
        .error{color:#c00;text-align:center;font-size:1.1rem}
    </style>
</head>

<body>
<h1 id="title">Menü lädt …</h1>
<div id="menu"></div>

<script>
    (async () => {
        const $title = document.getElementById('title');
        const $menu  = document.getElementById('menu');

        /* ------------------------------------------------------------------
           1 · Dateiname bestimmen (default: GdDPX6)
        ------------------------------------------------------------------ */
        const params   = new URLSearchParams(location.search);
        const fileName = params.get('file') || 'NAG6x3';
        const url      = `https://lehre.bpm.in.tum.de/~ge49fag/jsonpasser/data/${fileName}`;

        /* ------------------------------------------------------------------
           2 · JSON abrufen & parsen
        ------------------------------------------------------------------ */
        try{
            const res = await fetch(url);
            if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);

            const text = await res.text();
            let data;
            try {
                data = JSON.parse(text);
            } catch {
                throw new Error('Datei enthält kein gültiges JSON');
            }

            /* ----------------------------------------------------------------
               3 · Richtige Ebene finden  (days[0].dishes)
            ------------------------------------------------------------------ */
            const day = Array.isArray(data.days) ? data.days[0] : null;
            if (!day || !Array.isArray(day.dishes))
                throw new Error('JSON enthält kein days[0].dishes-Array');

            const d = new Date(day.date ?? Date.now());
            $title.textContent =
                `Speiseplan für ${d.toLocaleDateString('de-DE')}`;

            day.dishes.forEach(dish => {
                const card = document.createElement('section');
                card.className = 'dish';

                card.innerHTML =
                    `<h3>${dish.name}</h3>` +
                    (dish.labels?.length
                        ? `<p class="labels">${dish.labels.join(', ')}</p>` : '') +
                    (dish?.prices?.students?.base_price != null
                        ? `<p class="price">${dish.prices.students.base_price.toFixed(2)} € für Studierende</p>`
                        : '');

                $menu.appendChild(card);
            });

        }catch(err){
            $title.textContent = 'Fehler';
            $menu.innerHTML =
                `<p class="error">Konnte Daten nicht laden: ${err.message}</p>`;
        }
    })();
</script>
</body>
</html>
